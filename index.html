<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kick & Streamer.bot Bridge</title>
    <script src="https://js.pusher.com/8.3.0/pusher.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #0f0f0f; color: #e0e0e0; min-height: 100vh; padding: 0; margin: 0; }
        .hidden { display: none !important; }
        .center-error { display: flex; align-items: center; justify-content: center; height: 100vh; width: 100vw; position: fixed; top: 0; left: 0; z-index: 9999; background: rgba(15,15,15,0.97); }
        .error-box { background: #ff3b3b; color: #fff; padding: 2em 2.5em; border-radius: 14px; font-size: 1.3em; font-weight: bold; box-shadow: 0 4px 32px rgba(0,0,0,0.25); text-align: center; border: 2px solid #fff; }
    </style>
</head>
<body>
    <div id="error-container" class="center-error hidden">
        <div id="error-box" class="error-box"></div>
    </div>
    <script>
        // --- Settings Loader ---
        function getQueryParam(name) {
            const url = new URL(window.location.href);
            return url.searchParams.get(name);
        }
        function getSetting(name) {
            // Prefer query param, fallback to localStorage
            const qp = getQueryParam(name);
            if (qp) return qp;
            const settings = JSON.parse(localStorage.getItem('kickBridgeSettings') || '{}');
            if (name === 'chatroom_id') return settings.chatroomId;
            if (name === 'sb_ip') return settings.sbIp;
            if (name === 'sb_port') return settings.sbPort;
            if (name === 'reward_prefix') return settings.rewardPrefix;
            return undefined;
        }
        const chatroomId = getSetting('chatroom_id');
        const sbIp = getSetting('sb_ip');
        const sbPort = getSetting('sb_port');
        const rewardPrefix = getSetting('reward_prefix') || 'KickReward-';
        if (!chatroomId || !sbIp || !sbPort) {
            // Show nothing if any setting is missing
            document.body.innerHTML = '';
        } else {
            // Hide all UI by default
            function showError(message) {
                document.getElementById('error-box').textContent = message;
                document.getElementById('error-container').classList.remove('hidden');
            }
            function hideError() {
                document.getElementById('error-container').classList.add('hidden');
            }
            // --- Bridge code below (Account 1 only) ---
            const KICK_PUSHER_KEY = "32cbd69e4b950bf97679";
            const KICK_PUSHER_CLUSTER = "us2";
            const ACCOUNT = {
                id: 1,
                name: "KickUser",
                chatroomId: chatroomId,
                streamerId: chatroomId, // fallback, can be improved if needed
                channels: {
                    chatroom_v2: `chatrooms.${chatroomId}.v2`,
                    chatroom: `chatroom_${chatroomId}`,
                    chatrooms: `chatrooms.${chatroomId}`
                }
            };
            const SB_WEBSOCKET_IP = sbIp;
            const SB_WEBSOCKET_PORT = sbPort;
            const SB_WEBSOCKET_ENDPOINT = "/";
            const SB_ACTION_NAME_ON_CHAT = "YourChatActionName";
            const SB_ACTION_NAME_ON_FOLLOW = "YourFollowActionName"; // Replace with the SB action name for follows (if needed)
            // Add more action names for other events as needed

            let sbSocket = null;
            let loggingPaused = false;
            let pendingRequests = new Map(); // Track pending requests for error handling
            // Auth tokens removed - using public channels only

            // Auth management removed - using public channels only

            function logEvent(message, type = 'info', category = 'system') {
                if (
                    type === 'error' &&
                    (message.toLowerCase().includes('streamer.bot') ||
                     message.toLowerCase().includes('sb') ||
                     category === 'sb' ||
                     message.toLowerCase().includes('websocket'))
                ) {
                    showError('Cannot connect to Streamer.bot');
                } else if (
                    type === 'error' &&
                    (message.toLowerCase().includes('kick') || category === 'kick')
                ) {
                    showError('Cannot connect to Kick');
                }
                // Do not display any other UI
            }
            // ... rest of the bridge code remains unchanged ...
        }
    </script>
</body>
</html> 